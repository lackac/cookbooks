<%- [443, 444].each do |port| -%>
server {
  listen <%= port %>;
  passenger_enabled on;
  client_max_body_size 50M;
  server_name <%= @node[:chef][:server_fqdn] %> <%= @node[:chef][:server_hostname] %>;
  root <%= @node[:chef][:server_path] %>/public;
  access_log <%= @node[:nginx][:log_dir] %>/chef_server.access.log;

<%- %w{facebox images javascripts stylesheets web-app-theme}.each do |dir| -%>
  location /<%= dir %> {
    alias <%= @gems_path %>/gems/chef-server-slice-<%= @version %>/public/<%= dir %>;
  }
<%- end -%>

  ssl on;
  ssl_certificate /etc/chef/certificates/<%= @node[:chef][:server_fqdn] %>.pem;
  ssl_certificate_key /etc/chef/certificates/<%= @node[:chef][:server_fqdn] %>.pem;
}
<% end %>
